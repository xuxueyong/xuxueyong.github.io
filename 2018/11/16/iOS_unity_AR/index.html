<!DOCTYPE html>
<html lang="z">
<head>
    <meta charset="utf-8"/>
    <meta http-equiv="X-UA-Compatible" content="IE=edge"/>
    
    <title>在iOS项目中集成Unity(AR识别) | 云山之处</title>
    <meta name="renderer" content="webkit">
    <meta name="HandheldFriendly" content="True">
    <meta name="MobileOptimized" content="320">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

    <meta name="description" content="像写诗一样, 将写代码作为一门艺术.">

    <meta name="twitter:card" content="summary">
    <meta name="twitter:title" content="在iOS项目中集成Unity(AR识别) | 云山之处">
    <meta name="twitter:description" content="像写诗一样, 将写代码作为一门艺术.">

    <meta property="og:type" content="article">
    <meta property="og:title" content="在iOS项目中集成Unity(AR识别) | 云山之处">
    <meta property="og:description" content="像写诗一样, 将写代码作为一门艺术.">

    
    <meta name="author" content="徐雪勇">
    
    <link rel="stylesheet" href="/css/vno.css">
    <link rel="stylesheet" href="//netdna.bootstrapcdn.com/font-awesome/4.1.0/css/font-awesome.min.css">

    
    <link rel="icon" href="/images/avatar-small.png">
    

    <meta name="generator" content="hexo"/>
    
    <link rel="alternate" type="application/rss+xml" title="云山之处" href="/atom.xml">
    

    <link rel="canonical" href="http://xuxueyong.github.io/2018/11/16/iOS_unity_AR/"/>

                 
</head>

<body class="home-template no-js">
    <script src="//cdn.bootcss.com/jquery/2.1.4/jquery.min.js"></script>
    <script src="/js/main.js"></script>
    <span class="mobile btn-mobile-menu">
        <i class="fa fa-list btn-mobile-menu__icon"></i>
        <i class="fa fa-angle-up btn-mobile-close__icon hidden"></i>
    </span>

    
<header class="panel-cover panel-cover--collapsed" style="background-image: url(/images/background-cover.jpg)">
  <div class="panel-main">
    <div class="panel-main__inner panel-inverted">
    <div class="panel-main__content">

        <a href="/" title="前往 云山之处 的主页"><img src="/images/avatar.jpg" width="80" alt="云山之处 logo" class="panel-cover__logo logo"></a>
        <h1 class="panel-cover__title panel-title"><a href="/" title="link to homepage for 云山之处">云山之处</a></h1>
        
        <span class="panel-cover__subtitle panel-subtitle">最好的时代, 活出最好的自己</span>
        
        <hr class="panel-cover__divider">
        <p class="panel-cover__description">像写诗一样, 将写代码作为一门艺术.</p>
        <hr class="panel-cover__divider panel-cover__divider--secondary">

        <div class="navigation-wrapper">
          <div>
          <nav class="cover-navigation cover-navigation--primary">
            <ul class="navigation">
              <li class="navigation__item"><a href="/#blog" title="Visit the blog" class="blog-button">Blog</a></li>
            
              <li class="navigation__item"><a href="https://www.jianshu.com/u/823519e76f1a">简书</a></li>
            
              <li class="navigation__item"><a href="/favourite/time.html">时光机</a></li>
            
              <li class="navigation__item"><a href="/favourite/image.html">幻想间</a></li>
            
              <li class="navigation__item"><a href="/aboutme">关于我</a></li>
            
            </ul>
          </nav>
          </div>
          <div>
          <nav class="cover-navigation navigation--social">
  <ul class="navigation">

  <!-- Weibo-->
  
  <li class="navigation__item">
    <a href="https://weibo.com/u/2506861343?is_all=1" title="Weibo" target="_blank">
      <i class="social fa fa-weibo"></i>
      <span class="label">Weibo</span>
    </a>
  </li> 


  <!-- Github -->
  
  <li class="navigation__item">
    <a href="https://github.com/xuxueyong" title="GitHub" target="_blank">
      <i class="social fa fa-github"></i>
      <span class="label">Github</span>
    </a>
  </li>


<!-- Stack Overflow -->
        

  <!-- Google Plus -->
  

<!-- Facebook -->

  
<!-- Twitter -->

  

  <li class="navigation__item">
    <a href="/atom.xml" title="RSS" target="_blank">
      <i class="social fa fa-rss"></i>
      <span class="label">RSS</span>
    </a>
  </li>



  </ul>
</nav>

          </div>
        </div>

      </div>

    </div>

    <div class="panel-cover--overlay cover-blue"></div>
  </div> 
</header>

    <div class="content-wrapper">
        <div class="content-wrapper__inner">
            <article class="post-container post-container--single">

  <header class="post-header">
    <div class="post-meta">
      <time datetime="2018-11-16T05:45:43.849Z" class="post-list__meta--date date">2018-11-16</time> &#8226; <span class="post-meta__tags tags">于  </span>
      <span class="page-pv">
       Read <span id="busuanzi_value_page_pv"><i class="fa fa-spinner fa-spin"></i></span>
      </span> 
   
    </div>
    <h1 class="post-title">在iOS项目中集成Unity(AR识别)</h1>
  </header>

  <section class="post">
    <p><code>提示:</code> 在集成之前确保demo项目可以运行 (导出demo项目是最好用mac版Unity)</p>
<p><strong>1.新建立文件 Unity.xconfig</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">// 写入自己的untiy对应的版本号</span><br><span class="line">UNITY_RUNTIME_VERSION = 5.5.2f1;</span><br><span class="line">UNITY_SCRIPTING_BACKEND = il2cpp;</span><br><span class="line">UNITY_IOS_EXPORT_PATH = /Path/To/Your/Unity/iOS/Build;</span><br><span class="line">GCC_PREFIX_HEADER = $(UNITY_IOS_EXPORT_PATH)/Classes/Prefix.pch;</span><br><span class="line"></span><br><span class="line">OTHER_LDFLAGS = -weak-lSystem -weak_framework CoreMotion -weak_framework GameKit -weak_framework iAd -framework CoreGraphics -framework AVFoundation -framework CoreVideo -framework CoreMedia -framework SystemConfiguration -framework CoreLocation -framework MediaPlayer -framework CFNetwork -framework AudioToolbox -framework OpenAL -framework QuartzCore -framework OpenGLES -framework UIKit -framework Foundation -liconv.2 -liPhone-lib;</span><br><span class="line"></span><br><span class="line">HEADER_SEARCH_PATHS = &quot;$(UNITY_IOS_EXPORT_PATH)/Classes&quot; &quot;$(UNITY_IOS_EXPORT_PATH)/Classes/Native&quot; &quot;$(UNITY_IOS_EXPORT_PATH)/Libraries/libil2cpp/include&quot;;</span><br><span class="line">LIBRARY_SEARCH_PATHS = &quot;$(UNITY_IOS_EXPORT_PATH)/Libraries&quot; &quot;$(UNITY_IOS_EXPORT_PATH)/Libraries/libil2cpp/include&quot;;</span><br><span class="line"></span><br><span class="line">ENABLE_BITCODE = NO;</span><br><span class="line"></span><br><span class="line">SWIFT_OBJC_BRIDGING_HEADER = UnityBridge.h;</span><br><span class="line"></span><br><span class="line">OTHER_CFLAGS = -DINIT_SCRIPTING_BACKEND=1;</span><br><span class="line">CLANG_CXX_LANGUAGE_STANDARD = c++11;</span><br><span class="line">CLANG_CXX_LIBRARY = libc++;</span><br><span class="line">CLANG_ENABLE_MODULES = NO;</span><br><span class="line">CLANG_WARN_BOOL_CONVERSION = NO;</span><br><span class="line">CLANG_WARN_CONSTANT_CONVERSION = NO;</span><br><span class="line">CLANG_WARN_DIRECT_OBJC_ISA_USAGE = YES;</span><br><span class="line">CLANG_WARN_EMPTY_BODY = NO;</span><br><span class="line">CLANG_WARN_ENUM_CONVERSION = NO;</span><br><span class="line">CLANG_WARN_INT_CONVERSION = NO;</span><br><span class="line">CLANG_WARN_OBJC_ROOT_CLASS = YES;</span><br><span class="line">CLANG_WARN_UNREACHABLE_CODE = NO;</span><br><span class="line">CLANG_WARN__DUPLICATE_METHOD_MATCH = NO;</span><br><span class="line">GCC_C_LANGUAGE_STANDARD = c99;</span><br><span class="line">GCC_ENABLE_OBJC_EXCEPTIONS = NO;</span><br><span class="line">GCC_ENABLE_CPP_RTTI = NO;</span><br><span class="line">GCC_PRECOMPILE_PREFIX_HEADER = YES;</span><br><span class="line">GCC_THUMB_SUPPORT = NO;</span><br><span class="line">GCC_USE_INDIRECT_FUNCTION_CALLS = NO;</span><br><span class="line">GCC_WARN_64_TO_32_BIT_CONVERSION = NO;</span><br><span class="line">GCC_WARN_64_TO_32_BIT_CONVERSION[arch=*64] = YES;</span><br><span class="line">GCC_WARN_ABOUT_RETURN_TYPE = YES;</span><br><span class="line">GCC_WARN_UNDECLARED_SELECTOR = NO;</span><br><span class="line">GCC_WARN_UNINITIALIZED_AUTOS = NO;</span><br><span class="line">GCC_WARN_UNUSED_FUNCTION = NO;</span><br></pre></td></tr></table></figure>
<p><strong>2. project配置, 如下图</strong></p>
<p><img src="https://upload-images.jianshu.io/upload_images/4075144-43447160d62f64b9.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image.png"></p>
<p><strong>3.新建文件夹unity_ios, 并且将Classes  Data  Libraries 三个文件拷贝到该文件夹下</strong></p>
<p><img src="https://upload-images.jianshu.io/upload_images/4075144-ce5c5312327f233b.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image.png"><br><img src="https://upload-images.jianshu.io/upload_images/4075144-9dee8374f62ba67f.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image.png"></p>
<p>添加完成之后, 应该显示这样</p>
<p><img src="https://upload-images.jianshu.io/upload_images/4075144-63f388722fc294e4.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image.png"></p>
<p><strong>4.接下来下载三个文件, <a href="https://github.com/blitzagency/ios-unity5" target="_blank" rel="noopener">参考链接</a></strong></p>
<p>新建一个文件夹 objc, 将三个文件拷贝到此文件夹下</p>
<p><img src="https://upload-images.jianshu.io/upload_images/4075144-363f573ba0f2ff9c.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image.png"></p>
<p>UnityBridge.h 文件内容</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">#ifndef UnityBridge_h</span><br><span class="line">#define UnityBridge_h</span><br><span class="line"></span><br><span class="line">#import &lt;UIKit/UIKit.h&gt;</span><br><span class="line">#import &quot;UnityUtils.h&quot;</span><br><span class="line">#import &quot;UnityAppController.h&quot;</span><br><span class="line">#import &quot;UnityInterface.h&quot;</span><br><span class="line">#import &quot;ReceiveUnitySystemEvent.h&quot;</span><br><span class="line">#endif /* UnityBridge_h */</span><br></pre></td></tr></table></figure>
<p>UnityUtils.h文件内容</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">#ifndef UnityUtils_h</span><br><span class="line">#define UnityUtils_h</span><br><span class="line"></span><br><span class="line">void custom_unity_init(int argc, char* argv[]);</span><br><span class="line"></span><br><span class="line">#endif /* UnityUtils_h */</span><br></pre></td></tr></table></figure>
<p>UnityUtils.mm文件内容</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">#include &quot;RegisterMonoModules.h&quot;</span><br><span class="line">#include &quot;RegisterFeatures.h&quot;</span><br><span class="line">#include &lt;csignal&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">// Hack to work around iOS SDK 4.3 linker problem</span><br><span class="line">// we need at least one __TEXT, __const section entry in main application .o files</span><br><span class="line">// to get this section emitted at right time and so avoid LC_ENCRYPTION_INFO size miscalculation</span><br><span class="line">static const int constsection = 0;</span><br><span class="line"></span><br><span class="line">void UnityInitTrampoline();</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">extern &quot;C&quot; void custom_unity_init(int argc, char* argv[])</span><br><span class="line">&#123;</span><br><span class="line">    @autoreleasepool</span><br><span class="line">    &#123;</span><br><span class="line">        UnityInitTrampoline();</span><br><span class="line">        //        UnityParseCommandLine(argc, argv); //Unity 5.3+</span><br><span class="line">        UnityInitRuntime(argc, argv); //Unity 5.6+，5.4和5.5用哪个我没试过，可以根据报错情况选择。</span><br><span class="line">        </span><br><span class="line">        RegisterMonoModules();</span><br><span class="line">        NSLog(@&quot;-&gt; registered mono modules %p\n&quot;, &amp;constsection);</span><br><span class="line">        RegisterFeatures();</span><br><span class="line">        </span><br><span class="line">        // iOS terminates open sockets when an application enters background mode.</span><br><span class="line">        // The next write to any of such socket causes SIGPIPE signal being raised,</span><br><span class="line">        // even if the request has been done from scripting side. This disables the</span><br><span class="line">        // signal and allows Mono to throw a proper C# exception.</span><br><span class="line">        std::signal(SIGPIPE, SIG_IGN);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>注意三个文件都是用 create groups  (不要创建桥接文件 don’t create)</p>
<p><img src="https://upload-images.jianshu.io/upload_images/4075144-17caee0982ff5834.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image.png"></p>
<p><strong>5.模型文件的添加</strong></p>
<p><img src="https://upload-images.jianshu.io/upload_images/4075144-859ebd0bb8272252.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image.png"></p>
<p><strong>6. 修改这两个地方(build setting 最末端)</strong></p>
<p><img src="https://upload-images.jianshu.io/upload_images/4075144-e28343c7a3d957b2.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image.png"></p>
<p><strong>7. 修改桥接文件路径</strong></p>
<p><img src="https://upload-images.jianshu.io/upload_images/4075144-4d29d75a25ecfe8f.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image.png"></p>
<p><strong>8. 添加依赖库文件</strong></p>
<p><img src="https://upload-images.jianshu.io/upload_images/4075144-f3e540acece62bb5.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image.png"></p>
<p><strong>9. main.mm修改</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">// WARNING: this MUST be c decl (NSString ctor will be called after +load, so we cant really change its value)</span><br><span class="line">const char* AppControllerClassName = &quot;UnityAppController&quot;;</span><br><span class="line">int main_unity_default(int argc, char* argv[])</span><br><span class="line">&#123;</span><br><span class="line">    @autoreleasepool</span><br><span class="line">    &#123;</span><br><span class="line">        UnityInitTrampoline();</span><br><span class="line">        //        UnityParseCommandLine(argc, argv); //Unity 5.3+</span><br><span class="line">        UnityInitRuntime(argc, argv); //Unity 5.6+，5.4和5.5用哪个我没试过，可以根据报错情况选择。</span><br><span class="line">        </span><br><span class="line">        RegisterMonoModules();</span><br><span class="line">        NSLog(@&quot;-&gt; registered mono modules %p\n&quot;, &amp;constsection);</span><br><span class="line">        RegisterFeatures();</span><br><span class="line">        </span><br><span class="line">        // iOS terminates open sockets when an application enters background mode.</span><br><span class="line">        // The next write to any of such socket causes SIGPIPE signal being raised,</span><br><span class="line">        // even if the request has been done from scripting side. This disables the</span><br><span class="line">        // signal and allows Mono to throw a proper C# exception.</span><br><span class="line">        std::signal(SIGPIPE, SIG_IGN);</span><br><span class="line">        </span><br><span class="line">        //UIApplicationMain(argc, argv, nil, [NSString stringWithUTF8String:AppControllerClassName]);</span><br><span class="line">        //        UIApplicationMain(argc, argv, nil, NSStringFromClass([UnitySubAppDelegate class]));</span><br><span class="line">        UIApplicationMain(argc, argv, nil, [NSString stringWithUTF8String:AppControllerClassName]);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    return 0;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>10. UnityAppController.h文件修改</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">extern UnityAppController* _UnityAppController;</span><br><span class="line">NS_INLINE UnityAppController* GetAppController()</span><br><span class="line">&#123;</span><br><span class="line">    NSObject&lt;UIApplicationDelegate&gt;* delegate = [UIApplication sharedApplication].delegate;</span><br><span class="line">    UnityAppController* currentUnityController = (UnityAppController *)[delegate valueForKey:@&quot;currentUnityController&quot;];</span><br><span class="line">    return currentUnityController;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>11. 修改 Appdelegate.swift 文件</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">import UIKit</span><br><span class="line"></span><br><span class="line">//注释@UIApplicationMain, 让swift从main.swift启动</span><br><span class="line">//@UIApplicationMain</span><br><span class="line">class AppDelegate: UIResponder, UIApplicationDelegate &#123;</span><br><span class="line">    var window: UIWindow?</span><br><span class="line">    var currentUnityController: UnityAppController!</span><br><span class="line">    </span><br><span class="line">    func application(_ application: UIApplication, didFinishLaunchingWithOptions launchOptions: [UIApplication.LaunchOptionsKey: Any]?) -&gt; Bool &#123;</span><br><span class="line">        currentUnityController = UnityAppController()</span><br><span class="line">        currentUnityController.application(application, didFinishLaunchingWithOptions: launchOptions)</span><br><span class="line">        </span><br><span class="line">        window = UIWindow.init(frame: UIScreen.main.bounds)</span><br><span class="line">        let sb = UIStoryboard.init(name: &quot;Main&quot;, bundle: nil)</span><br><span class="line">        let vc = sb.instantiateInitialViewController()</span><br><span class="line">        window?.rootViewController = vc!;</span><br><span class="line">        window!.makeKeyAndVisible()</span><br><span class="line">        return true</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    func applicationWillResignActive(_ application: UIApplication) &#123;</span><br><span class="line">        currentUnityController.applicationWillResignActive(application)</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    func applicationDidEnterBackground(_ application: UIApplication) &#123;</span><br><span class="line">        currentUnityController.applicationDidEnterBackground(application)</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    func applicationWillEnterForeground(_ application: UIApplication) &#123;</span><br><span class="line">        currentUnityController.applicationWillEnterForeground(application)</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    func applicationDidBecomeActive(_ application: UIApplication) &#123;</span><br><span class="line">        currentUnityController.applicationDidBecomeActive(application)</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    func applicationWillTerminate(_ application: UIApplication) &#123;</span><br><span class="line">        currentUnityController.applicationWillTerminate(application)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>12.添加main.swift文件</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">import Foundation</span><br><span class="line">import UIKit</span><br><span class="line"></span><br><span class="line">custom_unity_init(CommandLine.argc, CommandLine.unsafeArgv)</span><br><span class="line"></span><br><span class="line">UIApplicationMain(</span><br><span class="line">    CommandLine.argc,</span><br><span class="line">    UnsafeMutableRawPointer(CommandLine.unsafeArgv)</span><br><span class="line">        .bindMemory(</span><br><span class="line">            to: UnsafeMutablePointer&lt;Int8&gt;.self,</span><br><span class="line">            capacity: Int(CommandLine.argc)),</span><br><span class="line">    nil,</span><br><span class="line">    NSStringFromClass(AppDelegate.self)</span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<p><strong>13.修改ViewController.swift 文件使用AR</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">@IBAction func loadUnity(sender: UIButton) &#123;</span><br><span class="line">        let unityview = UnityGetGLView()</span><br><span class="line">        unityview?.translatesAutoresizingMaskIntoConstraints = false</span><br><span class="line">        view.addSubview(unityview!)</span><br><span class="line">        let views = [&quot;view&quot;: unityview]</span><br><span class="line">        let w = NSLayoutConstraint.constraints(withVisualFormat: &quot;|[view]|&quot;, options: [], metrics: nil, views: views)</span><br><span class="line">        let h = NSLayoutConstraint.constraints(withVisualFormat: &quot;V:|[view]|&quot;, options: [], metrics: nil, views: views)</span><br><span class="line">        </span><br><span class="line">        view.addConstraints(w + h)</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p><strong>14. 停止AR识别</strong></p>
<p><a href="https://github.com/blitzagency/ios-unity5" target="_blank" rel="noopener">https://github.com/blitzagency/ios-unity5</a></p>
<p><strong>15.easyAR 需要修改的地方 (相机黑屏没有画面)</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">extern &quot;C&quot; void ezarUnitySetGraphicsDevice(void* device, int deviceType, int eventType);</span><br><span class="line">extern &quot;C&quot; void ezarUnityRenderEvent(int marker);</span><br><span class="line"></span><br><span class="line">- (void)shouldAttachRenderDelegate &#123;</span><br><span class="line">//新增</span><br><span class="line">UnityRegisterRenderingPlugin(&amp;ezarUnitySetGraphicsDevice, &amp;ezarUnityRenderEvent);</span><br><span class="line">//新增</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>###遇到的一些问题</p>
<p>#####问题一:<br>shellScript = “\”$PROJECT_DIR/MapFileParser.sh\””\nrm -rf</p>
<p>将多了的引号删除</p>
<p>#####问题二:<br>_DefaultTrackableEventHandler_OnTrackingFound_m4202593607 in Bulk_Assembly-CSharp_0.o</p>
<p>iOS中自定义函数未定义</p>
<p>#####问题三<br>dataSet  加载失败, 是由于没找到相关路径.</p>
<p> 直接在项目路径下拷贝一份资源文件</p>
<p>#####问题四:<br>相机6s 黑屏问题<br>用 Mac unity 2018  导出包</p>
<p>#####问题五: 打开 和 暂停<br><a href="https://github.com/blitzagency/ios-unity5" target="_blank" rel="noopener">https://github.com/blitzagency/ios-unity5</a></p>
<h5 id="问题六-Objective-C不能用-try"><a href="#问题六-Objective-C不能用-try" class="headerlink" title="问题六: Objective-C不能用@try*"></a>问题六: Objective-C不能用@try*</h5><p>今天遇到Cannot use ‘@try’ with Objective-C exceptions disable，解决方法：将LLVM 6.1 - Language - Objective C -&gt; Enable Objective-C Exceptions改为YES。</p>
<h5 id="问题七-“-AppControllerClassName”-referenced-from"><a href="#问题七-“-AppControllerClassName”-referenced-from" class="headerlink" title="问题七: “_AppControllerClassName”, referenced from:"></a>问题七: “_AppControllerClassName”, referenced from:</h5><pre><code>+[VuforiaNativeRendererController(OverrideAppDelegate) load] in VuforiaNativeRendererController.o
</code></pre><p>修改  main.mm 中的方法</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">const char* AppControllerClassName = &quot;UnityAppController&quot;;</span><br><span class="line"></span><br><span class="line">int main_unity_default(int argc, char* argv[])</span><br><span class="line">&#123;</span><br><span class="line">    @autoreleasepool</span><br><span class="line">    &#123;</span><br><span class="line">        UnityInitTrampoline();</span><br><span class="line">        //        UnityParseCommandLine(argc, argv); //Unity 5.3+</span><br><span class="line">        UnityInitRuntime(argc, argv); //Unity 5.6+，5.4和5.5用哪个我没试过，可以根据报错情况选择。</span><br><span class="line">        </span><br><span class="line">        RegisterMonoModules();</span><br><span class="line">        NSLog(@&quot;-&gt; registered mono modules %p\n&quot;, &amp;constsection);</span><br><span class="line">        RegisterFeatures();</span><br><span class="line">        </span><br><span class="line">        // iOS terminates open sockets when an application enters background mode.</span><br><span class="line">        // The next write to any of such socket causes SIGPIPE signal being raised,</span><br><span class="line">        // even if the request has been done from scripting side. This disables the</span><br><span class="line">        // signal and allows Mono to throw a proper C# exception.</span><br><span class="line">        std::signal(SIGPIPE, SIG_IGN);</span><br><span class="line">        </span><br><span class="line">        //UIApplicationMain(argc, argv, nil, [NSString stringWithUTF8String:AppControllerClassName]);</span><br><span class="line">        //        UIApplicationMain(argc, argv, nil, NSStringFromClass([UnitySubAppDelegate class]));</span><br><span class="line">        UIApplicationMain(argc, argv, nil, [NSString stringWithUTF8String:AppControllerClassName]);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    return 0;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>#####问题八:  <em>Library not loaded: @rpath/Vuforia.framework/Vuforia</em><br>Image not load </p>
<p><img src="https://upload-images.jianshu.io/upload_images/4075144-3300d00ce5cd6d2b.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="ADEFEA2C-14FE-485C-8F48-A9039D465AD5.png"></p>
<h5 id="问题九-Xcode-release下调试报错-Project-Name-was-compiled-with-optimization-stepping-may-behave-oddly-variables-may-not-be-available"><a href="#问题九-Xcode-release下调试报错-Project-Name-was-compiled-with-optimization-stepping-may-behave-oddly-variables-may-not-be-available" class="headerlink" title="问题九: Xcode release下调试报错[Project Name] was compiled with optimization - stepping may behave oddly; variables may not be available"></a>问题九: Xcode release下调试报错[Project Name] was compiled with optimization - stepping may behave oddly; variables may not be available</h5><ul>
<li>解决：Build Setting中的optimization level release改为与debug一样的模式。-</li>
<li>updated your OTHER_CFLAGS in .xcconfig to<br>OTHER_CFLAGS = $(inherited) -DINIT_SCRIPTING_BACKEND=1 -fno-strict-overflow -DRUNTIME_IL2CPP=1;<br>added the @objc in front of var currentUnityController: UnityAppController!</li>
</ul>
<h5 id="问题十-打包时报错"><a href="#问题十-打包时报错" class="headerlink" title="问题十: 打包时报错"></a>问题十: 打包时报错</h5><p>no match func objc_msgsend<br>解决方法:<br>[image:BC6992C7-CA27-4EE3-84F1-B046DD9CF584-3925-00006B91ED0379F1/07DB4B63-738D-446B-AE92-A0ECC8373448.png]<br>设置为 NO</p>
<h5 id="问题十一-打包时-Swift-build-error-if-any-output-files-are-specified-they-all-must-be"><a href="#问题十一-打包时-Swift-build-error-if-any-output-files-are-specified-they-all-must-be" class="headerlink" title="问题十一:  打包时 Swift build error_if_any_output_files_are_specified_they_all_must_be"></a>问题十一:  打包时 Swift build error_if_any_output_files_are_specified_they_all_must_be</h5><p>修改<br>[image:54368292-E997-4C27-B26F-EC5A19BC9F11-3925-00006CBDC9844CEC/4E5A069D-1DC0-4C9B-9FF7-F20E138AFBBC.png]<br>debug 和 release 修改为increasemental</p>
<h5 id="问题十二-error-unexpected-input-file-Applications-Xcode-app-Contents-Developer-Platforms-iPhoneOS-platform-Developer-SDKs-iPhoneOS12-0-sdk"><a href="#问题十二-error-unexpected-input-file-Applications-Xcode-app-Contents-Developer-Platforms-iPhoneOS-platform-Developer-SDKs-iPhoneOS12-0-sdk" class="headerlink" title="问题十二:  error: unexpected input file: /Applications/Xcode.app/Contents/Developer/Platforms/iPhoneOS.platform/Developer/SDKs/iPhoneOS12.0.sdk"></a>问题十二:  error: unexpected input file: /Applications/Xcode.app/Contents/Developer/Platforms/iPhoneOS.platform/Developer/SDKs/iPhoneOS12.0.sdk</h5><p>other swift flag 配置错误了</p>
<p>####参考链接<br><a href="https://www.jianshu.com/p/e8217896d6ff" target="_blank" rel="noopener">参考1</a><br><a href="https://www.jianshu.com/p/a3df2922d98d" target="_blank" rel="noopener">参考2</a></p>

  </section>

</article>

<section class="read-more">
           
    
               
            <div class="read-more-item">
                <span class="read-more-item-dim">Newer Post</span>
                <h2 class="post-list__post-title post-title"><a href="/2018/11/16/CocoaPods 公有仓库的建立/" title="CocoaPods 公有仓库的建立">CocoaPods 公有仓库的建立</a></h2>
                <p class="excerpt">
                
                ##查看 cocoapods  Specs 索引目录
###两种方式
1.终端:   cd ~/.cocoapods/repos/master 
123open .   . 代表当前目录.. 代表上级目录
 2.finder: 显示隐藏文件       先在终端执行命令
1defaults writ
                &hellip;
                </p>
                <div class="post-list__meta"><time datetime="2018-11-16T07:19:31.763Z" class="post-list__meta--date date">2018-11-16</time> &#8226; <span class="post-list__meta--tags tags">于 </span><a class="btn-border-small" href="/2018/11/16/CocoaPods 公有仓库的建立/">继续阅读</a></div>
                           
            </div>
        
        
               
            <div class="read-more-item">
                <span class="read-more-item-dim">Older Post</span>
                <h2 class="post-list__post-title post-title"><a href="/2018/11/16/R•swift 使用/" title="怎样更好的使用 R.swift">怎样更好的使用 R.swift</a></h2>
                <p class="excerpt">
                
                1. 在Podfile 中添加 pod ‘R.swift’R.swift
2. 在项目中添加脚本
3. 修改脚本1&amp;quot;$PODS_ROOT/R.swift/rswift&amp;quot; generate &amp;quot;$SRCROOT/testUIDemo01&amp;quot;

4. command 
                &hellip;
                </p>
                <div class="post-list__meta"><time datetime="2018-11-16T01:45:22.274Z" class="post-list__meta--date date">2018-11-16</time> &#8226; <span class="post-list__meta--tags tags">于 </span><a class="btn-border-small" href="/2018/11/16/R•swift 使用/">继续阅读</a></div>
                       
            </div>
        
     
   
   
  
</section>

  

            <footer class="footer">
    <span class="footer__copyright">
        &copy; 2018 徐雪勇 - 本站点采用 <a href="http://creativecommons.org/licenses/by-nc-sa/4.0/">知识共享署名-非商业性使用-相同方式共享 4.0 国际许可协议</a>
       
    </span>
    <span class="footer__copyright">
             - 基于 <a href="http://hexo.io">Hexo</a> 搭建，使用 <a href="https://github.com/monniya/hexo-theme-new-vno ">new-vno</a> 主题，由<a href="https://monniya.com ">@Monniya</a> 修改自 <a href="https://github.com/lenbo-ma/hexo-theme-vno" target="_blank">Vno</a>, 原创出自<a href="http://github.com/onevcat/vno" target="_blank">onevcat</a>
         </span>
       
    
    
</footer>


        </div>
    </div>

     
<script>
	(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
	(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
	m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
	})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

	ga('create', 'UA-78918255-1', 'auto');
	ga('send', 'pageview');
</script>

    
    <script>
        var _hmt = _hmt || [];
        (function() {
            var hm = document.createElement("script");
            hm.src = "//hm.baidu.com/hm.js?9cdad07c755fa23f6aced510c6760e87";
            var s = document.getElementsByTagName("script")[0]; 
            s.parentNode.insertBefore(hm, s);
        })();
    </script>



    <script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>
    
    
</body>
</html>
